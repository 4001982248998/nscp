cmake_minimum_required(VERSION 2.6)

SET(TARGET perfconfig_parser)
ADD_DEFINITIONS(${NSCP_GLOBAL_DEFINES})

SET(SRCS
	${NSCP_INCLUDEDIR}/parsers/perfconfig/perfconfig.cpp
)
IF(WIN32)
	SET(SRCS ${SRCS}
		${NSCP_INCLUDEDIR}/parsers/perfconfig/perfconfig.hpp
	)
ENDIF(WIN32)

ADD_LIBRARY(${TARGET} STATIC ${SRCS})
SET_TARGET_PROPERTIES(${TARGET} PROPERTIES FOLDER "libraries")
IF(CMAKE_COMPILER_IS_GNUCXX)
	IF("${CMAKE_SYSTEM_PROCESSOR}" STREQUAL "x86_64" AND NOT APPLE)
		SET_TARGET_PROPERTIES(${TARGET} PROPERTIES COMPILE_FLAGS -fPIC)
	ENDIF("${CMAKE_SYSTEM_PROCESSOR}" STREQUAL "x86_64" AND NOT APPLE)
ENDIF(CMAKE_COMPILER_IS_GNUCXX)


IF(GTEST_FOUND)
	INCLUDE_DIRECTORIES(${GTEST_INCLUDE_DIR})
	SET(SRCS
		perfconfig_test.cpp
	)
	ADD_EXECUTABLE(${TARGET}_test ${SRCS})
	IF(MSVC11)
		SET_TARGET_PROPERTIES(${TARGET}_test PROPERTIES COMPILE_FLAGS "-DGTEST_HAS_TR1_TUPLE=1 -D_VARIADIC_MAX=10 -DGTEST_USE_OWN_TR1_TUPLE=0")
	ENDIF(MSVC11)
	TARGET_LINK_LIBRARIES(${TARGET}_test
		${GTEST_GTEST_LIBRARY}
		${GTEST_GTEST_MAIN_LIBRARY}
		${TARGET}
	)
	SET_TARGET_PROPERTIES(${TARGET}_test PROPERTIES FOLDER "tests")
	ADD_TEST(${TARGET}_test ${TARGET}_test)
ENDIF(GTEST_FOUND)
